<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <title>Jogo da bolinha</title>
    <style>
        canvas {
            border: 1px black solid;
            background-color: rgba(255, 255, 255);
        }

        .contentDiv {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .input {
            width: 100px;
            outline: none;
            border-color: antiquewhite;
        }

        #startDiv {
            display: flex;
            align-items: center;
        }

        .titleDiv {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .input-group {
            justify-content: center;
            margin: 10px;
        }
    </style>
</head>

<body onkeydown="(keyDown(event))" onkeyup="keyUp(event)">
    <div class="titleDiv">
        <h1>Jogo da bolinha</h1>
    </div>

    <div class="contentDiv">
        <div id="canvasDiv" hidden=true>
            <canvas id="myCanvas" width="800px" height="600px"></canvas>
        </div>
        <div id="startDiv">
            <div class="row">
                <div class="col-md-12 input-group" style="display: flex; align-items: center;">
                    <span style="margin: 2px;">Selecione a cor da bolinha:</span>
                    <input id='firstColor' type='color' value='#4e55fd' style="margin: 2px;">
                </div>
                <div class="col-md-12 input-group" style="display: flex; align-items: center;">
                    <span style="margin: 2px;">Selecione o tamanho da bolinha:</span>
                    <input id='firstSize' type='number' value='20' min="20" max="50" style="margin: 2px;">
                </div>
                <button id='start' class="btn btn-outline-secondary btn-block" onclick='start();'>Começar</button>
            </div>
        </div>
    </div>
    <script>
        class Ball {
            constructor(color, size, x, y, movementVector) {
                this.color = color;
                this.size = size;
                this.x = x;
                this.y = y;
            }
        }   

        const SPEED = 5;
        var speed = 5;

        var canvas = document.getElementById('myCanvas');
        var context = canvas.getContext('2d');

        var keys = {}

        var ball = new Ball();

        function keyDown(event) {
            keys[event.keyCode] = true;
            if (keys[32]) speed = SPEED * 3;

            if (keys[37] && isValidMovement(37)) ball.x -= speed;
            if (keys[38] && isValidMovement(38)) ball.y -= speed;
            if (keys[39] && isValidMovement(39)) ball.x += speed;
            if (keys[40] && isValidMovement(40)) ball.y += speed;

            drawBall();
        }

        function keyUp(event) {
            keys[event.keyCode] = false;
            if (event.keyCode === 32) {
                speed = SPEED;
            }
        
            if(Object.values(keys).indexOf(true) == -1)
                clearCanvas();
        }

        function start() {
            ball.color = document.getElementById('firstColor').value;
            ball.size = Number(document.getElementById('firstSize').value);
            ball.x = ball.size; 
            ball.y = ball.size;
            drawBall();

            document.getElementById('startDiv').hidden = true;
            document.getElementById('canvasDiv').hidden = false;
        }

        function drawBall() {
            context.fillStyle = 'rgba(255, 255, 255, .4)';
            context.fillRect(0, 0, this.canvas.width, this.canvas.height);
            context.beginPath();
            context.fillStyle = ball.color;
            context.arc(ball.x, ball.y, ball.size, 0, 2 * Math.PI);
            context.fill();
        }

        function clearCanvas(){
            context.clearRect(0, 0, canvas.width, canvas.height);
            drawBall();
        }
        
        function isValidMovement(key) {
            switch (key) {
                case 37:
                    if (ball.x - ball.size - speed < 0) {
                        console.log("Não é mais possível ir para Esquerda");
                        ball.x = ball.size + speed;
                    }
                    else {
                        return true;
                    }
                    break;
                case 38:
                    if (ball.y - ball.size - speed < 0) {
                        console.log("Não é mais possível ir para Cima");
                        ball.y = ball.size + speed;
                    }
                    else {
                        return true;
                    }
                    break;
                case 39:
                    if (ball.x + ball.size + speed > canvas.width) {
                        console.log("Não é mais possível ir para Direita ");
                        ball.x = canvas.width - ball.size - speed;
                    }
                    else {
                        return true;
                    }
                    break;
                case 40:
                    if (ball.y + ball.size + speed > canvas.height) {
                        console.log("Não é mais possível ir para Baixo");
                        ball.y = canvas.height - ball.size - speed;
                    }
                    else {
                        return true;
                    }
                    break;7
            }
            return false;
        }
    </script>
</body>

</html>